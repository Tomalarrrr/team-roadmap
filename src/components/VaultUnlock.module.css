/* ============================================
   Vault Unlock Overlay
   Premium dark metallic vault-door aesthetic
   ============================================ */

.overlay {
  position: fixed;
  inset: 0;
  background: rgba(8, 10, 18, 0.88);
  backdrop-filter: blur(12px);
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 1100;
  animation: vaultOverlayIn 300ms ease forwards;
}

.overlay.exiting {
  animation: vaultOverlayOut 350ms ease forwards;
}

/* ---- Card ---- */

.card {
  background: linear-gradient(160deg, #1e2028 0%, #14161b 100%);
  border: 1px solid rgba(255, 255, 255, 0.08);
  border-radius: 16px;
  padding: 40px 40px 32px;
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 20px;
  box-shadow:
    0 0 80px rgba(59, 130, 246, 0.06),
    0 25px 60px rgba(0, 0, 0, 0.55);
  animation: vaultCardIn 400ms cubic-bezier(0.34, 1.56, 0.64, 1) forwards;
  transform: translateZ(0);
  will-change: transform, opacity;
  max-width: 380px;
  width: 92%;
  position: relative;
  overflow: hidden;
}

.card::before {
  content: '';
  position: absolute;
  inset: 0;
  border-radius: 16px;
  background: radial-gradient(
    ellipse 60% 40% at 50% 0%,
    rgba(255, 255, 255, 0.04) 0%,
    transparent 70%
  );
  pointer-events: none;
}

.card.exiting {
  animation: vaultCardOut 300ms var(--ease-in-out, cubic-bezier(0.4, 0, 0.2, 1)) forwards;
}

.card.success {
  animation: vaultGlow 800ms ease forwards;
}

/* ---- Vault Icon ---- */

.vaultIconContainer {
  position: relative;
  width: 64px;
  height: 64px;
  margin-bottom: 2px;
}

.vaultIcon {
  width: 64px;
  height: 64px;
  display: block;
}

/* Radial pulse ring on success */
.vaultIconContainer.success::after {
  content: '';
  position: absolute;
  top: 50%;
  left: 50%;
  width: 64px;
  height: 64px;
  border-radius: 50%;
  border: 2px solid var(--success-green, #22c55e);
  transform: translate(-50%, -50%) scale(1);
  animation: pulseRing 700ms var(--ease-out-expo, cubic-bezier(0.16, 1, 0.3, 1)) forwards;
  pointer-events: none;
}

.dialGroup {
  transition: transform 200ms ease;
  transform-origin: 32px 32px;
}

.dialGroup.spinning {
  animation: vaultDialSpin 700ms var(--ease-out-expo, cubic-bezier(0.16, 1, 0.3, 1)) forwards;
}

.shackle {
  transition: transform 200ms ease;
  transform-origin: 38px 30px;
}

.shackleOpen {
  animation: shackleLift 600ms var(--ease-out-expo, cubic-bezier(0.16, 1, 0.3, 1)) forwards;
}

.keyholeGroup {
  transition: color 300ms ease;
  color: rgba(255, 255, 255, 0.45);
}

.keyholeSuccess {
  color: var(--success-green, #22c55e);
}

/* ---- Title ---- */

.title {
  color: rgba(255, 255, 255, 0.85);
  font-size: 0.85rem;
  font-weight: 500;
  letter-spacing: 0.12em;
  text-transform: uppercase;
  margin: 0;
  animation: fadeInUp 300ms var(--ease-out-expo, cubic-bezier(0.16, 1, 0.3, 1)) 100ms backwards;
}

/* ---- Digit Row ---- */

.digitRow {
  display: flex;
  gap: 12px;
  animation: fadeInUp 300ms var(--ease-out-expo, cubic-bezier(0.16, 1, 0.3, 1)) 150ms backwards;
}

.digitRow.shaking {
  animation: vaultShake 500ms ease;
}

/* ---- Digit Box ---- */

.digitBox {
  position: relative;
  width: 60px;
  height: 72px;
  border-radius: 12px;
  background: rgba(255, 255, 255, 0.04);
  border: 2px solid rgba(255, 255, 255, 0.10);
  display: flex;
  align-items: center;
  justify-content: center;
  transition:
    border-color 200ms ease,
    box-shadow 200ms ease,
    background 200ms ease,
    transform 200ms cubic-bezier(0.34, 1.56, 0.64, 1);
  cursor: text;
  animation: digitBoxIn 280ms cubic-bezier(0.34, 1.56, 0.64, 1) backwards;
}

.digitBox:nth-child(1) { animation-delay: 200ms; }
.digitBox:nth-child(2) { animation-delay: 250ms; }
.digitBox:nth-child(3) { animation-delay: 300ms; }
.digitBox:nth-child(4) { animation-delay: 350ms; }

.digitBox.focused {
  border-color: var(--accent-blue, #3b82f6);
  box-shadow:
    0 0 0 3px rgba(59, 130, 246, 0.18),
    0 0 20px rgba(59, 130, 246, 0.08);
  background: rgba(59, 130, 246, 0.05);
}

.digitBox.filled {
  border-color: rgba(255, 255, 255, 0.22);
  background: rgba(255, 255, 255, 0.06);
}

.digitBox.filled .digitDisplay {
  animation: digitPop 200ms cubic-bezier(0.34, 1.56, 0.64, 1);
}

.digitBox.error {
  border-color: var(--error-red, #ef4444);
  box-shadow: 0 0 16px rgba(239, 68, 68, 0.25);
  background: rgba(239, 68, 68, 0.06);
}

.digitBox.success {
  border-color: var(--success-green, #22c55e);
  box-shadow: 0 0 16px rgba(34, 197, 94, 0.25);
  background: rgba(34, 197, 94, 0.06);
  transition-delay: 0ms;
}

/* Staggered left-to-right green wave on success */
.digitBox.success:nth-child(1) { transition-delay: 0ms; }
.digitBox.success:nth-child(2) { transition-delay: 80ms; }
.digitBox.success:nth-child(3) { transition-delay: 160ms; }
.digitBox.success:nth-child(4) { transition-delay: 240ms; }

.digitBox.success .digitDisplay {
  color: var(--success-green, #22c55e);
  transition: color 250ms ease;
}

/* Red digit text on error */
.digitBox.error .digitDisplay {
  color: var(--error-red, #ef4444);
  transition: color 150ms ease;
}

/* Hidden native input â€” positioned over the box for focus/keyboard capture */
.digitInput {
  position: absolute;
  inset: 0;
  width: 100%;
  height: 100%;
  opacity: 0;
  border: none;
  background: none;
  font-size: 1rem;
  text-align: center;
  cursor: text;
  caret-color: transparent;
  z-index: 1;
}

.digitInput:focus {
  outline: none;
}

/* Visible digit */
.digitDisplay {
  font-family: 'SF Mono', 'Fira Code', 'JetBrains Mono', 'Cascadia Code', monospace;
  font-size: 1.7rem;
  font-weight: 700;
  color: #ffffff;
  line-height: 1;
  pointer-events: none;
  user-select: none;
  min-height: 1.7rem;
}

/* Blinking cursor for active empty box */
.digitCursor {
  width: 2px;
  height: 24px;
  background: var(--accent-blue, #3b82f6);
  border-radius: 1px;
  animation: cursorBlink 1s step-end infinite;
  pointer-events: none;
}

/* ---- Feedback Area ---- */

.feedback {
  min-height: 24px;
  display: flex;
  align-items: center;
  justify-content: center;
}

.feedbackError {
  color: var(--error-red, #ef4444);
  font-size: 0.85rem;
  font-weight: 500;
  animation: fadeInUp 200ms var(--ease-out-expo, cubic-bezier(0.16, 1, 0.3, 1));
}

.feedbackSuccess {
  color: var(--success-green, #22c55e);
  font-size: 0.85rem;
  font-weight: 600;
  letter-spacing: 0.05em;
  text-transform: uppercase;
  animation: successTextIn 350ms cubic-bezier(0.34, 1.56, 0.64, 1) 200ms backwards;
}

/* ---- Hint ---- */

.hint {
  color: rgba(255, 255, 255, 0.28);
  font-size: 0.75rem;
  margin: 0;
  animation: fadeInUp 300ms var(--ease-out-expo, cubic-bezier(0.16, 1, 0.3, 1)) 300ms backwards;
}

/* ============================================
   Keyframes
   ============================================ */

@keyframes vaultOverlayIn {
  from {
    opacity: 0;
    backdrop-filter: blur(0px);
  }
  to {
    opacity: 1;
    backdrop-filter: blur(12px);
  }
}

@keyframes vaultOverlayOut {
  from {
    opacity: 1;
    backdrop-filter: blur(12px);
  }
  to {
    opacity: 0;
    backdrop-filter: blur(0px);
  }
}

@keyframes vaultCardIn {
  0% {
    opacity: 0;
    transform: scale(0.82) translateY(24px) translateZ(0);
  }
  60% {
    opacity: 1;
    transform: scale(1.03) translateY(-3px) translateZ(0);
  }
  100% {
    opacity: 1;
    transform: scale(1) translateY(0) translateZ(0);
  }
}

@keyframes vaultCardOut {
  from {
    opacity: 1;
    transform: scale(1) translateY(0) translateZ(0);
  }
  to {
    opacity: 0;
    transform: scale(0.92) translateY(18px) translateZ(0);
  }
}

@keyframes digitBoxIn {
  from {
    opacity: 0;
    transform: translateY(14px) scale(0.75);
  }
  to {
    opacity: 1;
    transform: translateY(0) scale(1);
  }
}

@keyframes digitPop {
  0% { transform: scale(1); }
  40% { transform: scale(1.18); }
  100% { transform: scale(1); }
}

@keyframes vaultShake {
  0%, 100% { transform: translateX(0); }
  10% { transform: translateX(-10px); }
  20% { transform: translateX(10px); }
  30% { transform: translateX(-8px); }
  40% { transform: translateX(8px); }
  50% { transform: translateX(-5px); }
  60% { transform: translateX(5px); }
  70% { transform: translateX(-3px); }
  80% { transform: translateX(3px); }
}

@keyframes vaultDialSpin {
  from { transform: rotate(0deg); }
  to { transform: rotate(360deg); }
}

@keyframes shackleLift {
  0% {
    transform: rotate(0deg) translateY(0);
  }
  100% {
    transform: rotate(-30deg) translateY(-4px);
  }
}

@keyframes vaultGlow {
  0% {
    box-shadow:
      0 0 80px rgba(34, 197, 94, 0.0),
      0 25px 60px rgba(0, 0, 0, 0.55);
  }
  40% {
    box-shadow:
      0 0 100px rgba(34, 197, 94, 0.25),
      0 25px 60px rgba(0, 0, 0, 0.55);
  }
  100% {
    box-shadow:
      0 0 80px rgba(34, 197, 94, 0.08),
      0 25px 60px rgba(0, 0, 0, 0.55);
  }
}

@keyframes fadeInUp {
  from {
    opacity: 0;
    transform: translateY(8px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

@keyframes pulseRing {
  0% {
    opacity: 0.8;
    transform: translate(-50%, -50%) scale(1);
  }
  100% {
    opacity: 0;
    transform: translate(-50%, -50%) scale(1.8);
  }
}

@keyframes cursorBlink {
  0%, 100% { opacity: 1; }
  50% { opacity: 0; }
}

@keyframes successTextIn {
  0% {
    opacity: 0;
    transform: translateY(6px) scale(0.9);
  }
  60% {
    opacity: 1;
    transform: translateY(-1px) scale(1.04);
  }
  100% {
    opacity: 1;
    transform: translateY(0) scale(1);
  }
}

/* ============================================
   Reduced motion
   ============================================ */

@media (prefers-reduced-motion: reduce) {
  .overlay,
  .card,
  .digitBox,
  .digitRow,
  .digitDisplay,
  .vaultIcon,
  .dialGroup,
  .shackle,
  .title,
  .hint,
  .feedback,
  .feedbackError,
  .feedbackSuccess,
  .digitCursor {
    animation-duration: 0.01ms !important;
    animation-iteration-count: 1 !important;
    transition-duration: 0.01ms !important;
  }
}
